(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[463],{6054:function(e,o,n){Promise.resolve().then(n.bind(n,7511))},7511:function(e,o,n){"use strict";n.r(o),n.d(o,{default:function(){return k}});var r=n(7437),t=n(2265),i=n(6463),l=n(3096),d=n(6305);n(605);let a={bg:"#F4F4F4",card:"#FFFFFF",text:"#0D0D0D",muted:"#888888",faint:"rgba(0,0,0,0.06)",border:"1px solid rgba(0,0,0,0.08)",shadow:"0 2px 12px rgba(0,0,0,0.06)",radius:"6px",mono:"'JetBrains Mono','Fira Mono',monospace",ui:"'Space Grotesk','Inter',sans-serif",mint:"#6CEFA0",blue:"#6CDDEF",purple:"#B06CEF",orange:"#EF9B6C",red:"#EF4444",yellow:"#F5C842"},s=[{id:"query-platform",name:"Query Platform",icon:"\uD83D\uDD0D",color:a.blue},{id:"generate-report",name:"AI Report",icon:"\uD83E\uDD16",color:a.purple},{id:"send-notification",name:"Send Notification",icon:"\uD83D\uDCE4",color:a.mint},{id:"call-webhook",name:"Call Webhook",icon:"\uD83D\uDD17",color:a.orange},{id:"run-script",name:"Run Script",icon:"⚙️",color:a.muted},{id:"transform-data",name:"Transform Data",icon:"\uD83D\uDD04",color:a.yellow},{id:"condition",name:"Condition",icon:"\uD83D\uDD00",color:a.purple},{id:"wait",name:"Wait",icon:"⏱️",color:a.muted}],c=[{id:"schedule",name:"Schedule",icon:"⏰",color:a.blue,desc:"Run on a cron schedule"},{id:"webhook",name:"Webhook",icon:"\uD83D\uDD17",color:a.mint,desc:"HTTP POST to generated URL"},{id:"db-change",name:"DB Change",icon:"\uD83D\uDDC4️",color:a.purple,desc:"Trigger on database table insert / update / delete"},{id:"db-condition",name:"DB Condition",icon:"\uD83D\uDD0E",color:a.orange,desc:"Poll until a database row matches a condition"},{id:"message",name:"Telegram Msg",icon:"\uD83D\uDCAC",color:a.blue,desc:"Triggered by Telegram message matching a pattern"},{id:"platform-event",name:"Platform Event",icon:"\uD83D\uDCE1",color:a.yellow,desc:"Triggered when platform data changes"},{id:"manual",name:"Manual",icon:"▶️",color:a.muted,desc:"Run manually on demand"}];function m(e){return s.find(o=>o.id===e)||{icon:"●",color:a.muted,name:e}}function u(e){return c.find(o=>o.id===e)||c[6]}function p(e){let{color:o,children:n,style:t={}}=e;return(0,r.jsx)("span",{style:{background:o||a.faint,borderRadius:4,padding:"2px 7px",fontSize:"0.57rem",fontFamily:a.mono,fontWeight:700,textTransform:"uppercase",letterSpacing:"0.06em",display:"inline-block",...t},children:n})}function g(e){let{onClick:o,children:n,ghost:t,small:i,disabled:l,color:d,style:s={}}=e;return(0,r.jsx)("button",{onClick:o,disabled:l,style:{background:t?a.card:d||a.text,color:t?a.muted:"#fff",border:t?"1px solid rgba(0,0,0,0.1)":"none",borderRadius:a.radius,padding:i?"0.28rem 0.65rem":"0.48rem 1.1rem",cursor:l?"not-allowed":"pointer",opacity:l?.5:1,fontFamily:a.mono,fontSize:i?"0.6rem":"0.68rem",textTransform:"uppercase",letterSpacing:"0.06em",whiteSpace:"nowrap",...s},children:n})}function f(e){let{value:o,onChange:n,placeholder:t,style:i={}}=e;return(0,r.jsx)("input",{value:o||"",onChange:e=>n(e.target.value),placeholder:t,style:{width:"100%",boxSizing:"border-box",background:a.bg,border:a.border,borderRadius:a.radius,padding:"0.32rem 0.55rem",fontFamily:a.mono,fontSize:"0.71rem",color:a.text,outline:"none",...i}})}function h(e){let{children:o}=e;return(0,r.jsx)("div",{style:{fontSize:"0.57rem",fontFamily:a.mono,color:a.muted,textTransform:"uppercase",letterSpacing:"0.08em",marginBottom:"0.28rem"},children:o})}function x(e){let{label:o,children:n}=e;return(0,r.jsxs)("div",{style:{marginBottom:"0.7rem"},children:[(0,r.jsx)(h,{children:o}),n]})}let y={trigger:function(e){var o;let{data:n}=e,t=u(null===(o=n.trigger)||void 0===o?void 0:o.type),i=n.trigger||{type:"manual",label:"Manual",config:{}},s=n.selected;return(0,r.jsxs)("div",{onClick:n.onSelect,style:{width:220,padding:"0.55rem 0.8rem",borderRadius:10,background:s?t.color+"1A":"#fff",border:"2px solid ".concat(s?t.color:"rgba(0,0,0,0.10)"),boxShadow:s?"0 0 0 4px ".concat(t.color,"28"):"0 2px 8px rgba(0,0,0,0.07)",cursor:"pointer",display:"flex",alignItems:"center",gap:"0.55rem",transition:"all 0.12s"},children:[(0,r.jsx)("span",{style:{fontSize:"1.3rem",flexShrink:0},children:t.icon}),(0,r.jsxs)("div",{style:{flex:1,minWidth:0},children:[(0,r.jsx)("div",{style:{fontSize:"0.55rem",fontFamily:a.mono,color:t.color,textTransform:"uppercase",letterSpacing:"0.08em"},children:"Trigger"}),(0,r.jsx)("div",{style:{fontWeight:700,fontSize:"0.8rem",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:i.label||t.name})]}),(0,r.jsx)(l.HH,{type:"source",position:d.Ly.Bottom,style:{background:t.color,width:8,height:8}})]})},step:function(e){var o;let{data:n}=e,t=m(null===(o=n.step)||void 0===o?void 0:o.skill),i=n.step||{},s=n.selected,c="condition"===i.skill;return(0,r.jsxs)("div",{onClick:n.onSelect,style:{width:220,padding:"0.5rem 0.75rem",borderRadius:c?6:8,background:s?t.color+"14":"#fff",border:"2px solid ".concat(s?t.color:"rgba(0,0,0,0.08)"),boxShadow:s?"0 0 0 4px ".concat(t.color,"22"):"0 1px 5px rgba(0,0,0,0.05)",cursor:"pointer",display:"flex",alignItems:"center",gap:"0.5rem",transition:"all 0.12s",transform:c?"rotate(45deg)":"none"},children:[c&&(0,r.jsxs)("div",{style:{transform:"rotate(-45deg)",display:"flex",alignItems:"center",gap:"0.5rem",width:"100%"},children:[(0,r.jsx)("span",{style:{fontSize:"1rem",flexShrink:0},children:t.icon}),(0,r.jsx)("div",{style:{flex:1,minWidth:0},children:(0,r.jsx)("div",{style:{fontWeight:600,fontSize:"0.77rem",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:i.name||t.name})})]}),!c&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{style:{width:20,height:20,borderRadius:"50%",background:s?t.color:a.faint,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.58rem",fontFamily:a.mono,color:s?"#fff":a.muted,flexShrink:0},children:n.index+1}),(0,r.jsx)("span",{style:{fontSize:"1rem",flexShrink:0},children:t.icon}),(0,r.jsxs)("div",{style:{flex:1,minWidth:0},children:[(0,r.jsx)("div",{style:{fontWeight:600,fontSize:"0.79rem",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:i.name||t.name}),i.description&&(0,r.jsx)("div",{style:{fontSize:"0.61rem",color:a.muted,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:i.description})]}),(0,r.jsx)(p,{color:t.color+"22",style:{color:t.color,flexShrink:0},children:i.skill})]}),(0,r.jsx)(l.HH,{type:"target",position:d.Ly.Top,style:{background:t.color,width:8,height:8}}),(0,r.jsx)(l.HH,{type:"source",position:d.Ly.Bottom,style:{background:t.color,width:8,height:8}})]})},end:function(){return(0,r.jsxs)("div",{style:{width:36,height:36,borderRadius:"50%",background:"#fff",border:"2.5px solid rgba(0,0,0,0.14)",display:"flex",alignItems:"center",justifyContent:"center"},children:[(0,r.jsx)("div",{style:{width:14,height:14,borderRadius:"50%",background:"rgba(0,0,0,0.2)"}}),(0,r.jsx)(l.HH,{type:"target",position:d.Ly.Top,style:{background:"rgba(0,0,0,0.2)",width:8,height:8}})]})}};function b(e){var o,n,t,i,l,d,s,m,u,p;let{trigger:g,onChange:h}=e,y=g||{type:"manual",label:"Manual",config:{}},b=e=>h({...y,...e,config:{...y.config||{},...e.config}}),v=e=>b({config:{...y.config||{},...e}});return(0,r.jsxs)("div",{children:[(0,r.jsx)(x,{label:"Trigger type",children:(0,r.jsx)("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.3rem"},children:c.map(e=>(0,r.jsxs)("button",{onClick:()=>b({type:e.id,label:e.name,config:{}}),style:{background:y.type===e.id?e.color+"22":a.faint,border:"1.5px solid ".concat(y.type===e.id?e.color:"transparent"),borderRadius:a.radius,padding:"0.22rem 0.5rem",cursor:"pointer",fontFamily:a.mono,fontSize:"0.6rem",color:y.type===e.id?e.color:a.muted,fontWeight:y.type===e.id?700:400},children:[e.icon," ",e.name]},e.id))})}),"schedule"===y.type&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(x,{label:"Cron expression",children:(0,r.jsx)(f,{value:(null===(o=y.config)||void 0===o?void 0:o.cron)||"0 9 * * 1-5",onChange:e=>b({label:"Schedule \xb7 "+e,config:{cron:e}}),placeholder:"0 9 * * 1-5"})}),(0,r.jsx)("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.3rem",marginBottom:"0.7rem"},children:[["0 9 * * 1-5","Weekdays 9am"],["0 * * * *","Every hour"],["*/30 * * * *","Every 30 min"],["0 0 * * *","Daily midnight"]].map(e=>{let[o,n]=e;return(0,r.jsx)("button",{onClick:()=>b({label:"Schedule \xb7 "+o,config:{cron:o}}),style:{background:a.faint,border:a.border,borderRadius:a.radius,padding:"0.18rem 0.45rem",cursor:"pointer",fontSize:"0.58rem",fontFamily:a.mono,color:a.muted},children:n},o)})})]}),"webhook"===y.type&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(x,{label:"Generated webhook URL",children:(0,r.jsx)("div",{style:{background:a.faint,borderRadius:a.radius,padding:"0.32rem 0.55rem",fontSize:"0.65rem",fontFamily:a.mono,color:a.muted},children:"POST /demo/workers/{id}/webhook"})}),(0,r.jsx)(x,{label:"Secret (optional)",children:(0,r.jsx)(f,{value:(null===(n=y.config)||void 0===n?void 0:n.secret)||"",onChange:e=>v({secret:e}),placeholder:"webhook-secret-xxx"})})]}),"db-change"===y.type&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(x,{label:"Table name",children:(0,r.jsx)(f,{value:(null===(t=y.config)||void 0===t?void 0:t.table)||"",onChange:e=>{v({table:e}),b({label:"DB \xb7 ".concat(e," change")})},placeholder:"contacts, orders, invoices…"})}),(0,r.jsx)(x,{label:"Event",children:(0,r.jsx)("div",{style:{display:"flex",gap:"0.28rem"},children:["insert","update","delete","any"].map(e=>{var o,n,t;return(0,r.jsx)("button",{onClick:()=>v({event:e}),style:{background:((null===(o=y.config)||void 0===o?void 0:o.event)||"any")===e?a.purple+"22":a.faint,border:"1.5px solid ".concat(((null===(n=y.config)||void 0===n?void 0:n.event)||"any")===e?a.purple:"transparent"),borderRadius:a.radius,padding:"0.22rem 0.45rem",cursor:"pointer",fontFamily:a.mono,fontSize:"0.6rem",color:((null===(t=y.config)||void 0===t?void 0:t.event)||"any")===e?a.purple:a.muted},children:e},e)})})}),(0,r.jsx)(x,{label:"Row filter (optional)",children:(0,r.jsx)(f,{value:(null===(i=y.config)||void 0===i?void 0:i.condition)||"",onChange:e=>v({condition:e}),placeholder:"amount > 1000"})}),(0,r.jsx)(x,{label:"Poll interval (s)",children:(0,r.jsx)(f,{value:String((null===(l=y.config)||void 0===l?void 0:l.pollIntervalSec)||30),onChange:e=>v({pollIntervalSec:parseInt(e)||30})})})]}),"db-condition"===y.type&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(x,{label:"Table name",children:(0,r.jsx)(f,{value:(null===(d=y.config)||void 0===d?void 0:d.table)||"",onChange:e=>{v({table:e}),b({label:"DB Condition \xb7 ".concat(e)})},placeholder:"invoices"})}),(0,r.jsx)(x,{label:"SQL condition",children:(0,r.jsx)("textarea",{value:(null===(s=y.config)||void 0===s?void 0:s.condition)||"",onChange:e=>v({condition:e.target.value}),placeholder:"status = 'overdue' AND amount > 500",rows:3,style:{width:"100%",boxSizing:"border-box",background:a.bg,border:a.border,borderRadius:a.radius,padding:"0.32rem 0.55rem",fontFamily:a.mono,fontSize:"0.7rem",color:a.text,outline:"none",resize:"vertical"}})}),(0,r.jsx)(x,{label:"Poll interval (s)",children:(0,r.jsx)(f,{value:String((null===(m=y.config)||void 0===m?void 0:m.pollIntervalSec)||60),onChange:e=>v({pollIntervalSec:parseInt(e)||60})})})]}),"message"===y.type&&(0,r.jsx)(x,{label:"Telegram pattern",children:(0,r.jsx)(f,{value:(null===(u=y.config)||void 0===u?void 0:u.pattern)||"",onChange:e=>{v({pattern:e}),b({label:"Message \xb7 ".concat(e)})},placeholder:"/report or keyword"})}),"platform-event"===y.type&&(0,r.jsx)(x,{label:"Condition",children:(0,r.jsx)(f,{value:(null===(p=y.config)||void 0===p?void 0:p.condition)||"",onChange:e=>{v({condition:e}),b({label:"Event \xb7 ".concat(e)})},placeholder:"transaction.amount > 500"})}),"manual"===y.type&&(0,r.jsx)("div",{style:{fontSize:"0.7rem",fontFamily:a.mono,color:a.muted,background:a.faint,padding:"0.45rem 0.65rem",borderRadius:a.radius},children:"No configuration — trigger manually from the dashboard."})]})}function v(e){let{step:o,stepIdx:n,stepsLen:t,onParamChange:i,onRemove:l,onMoveUp:d,onMoveDown:s}=e,c=m(o.skill);return(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"0.7rem"},children:[(0,r.jsx)("span",{style:{fontSize:"1.2rem"},children:c.icon}),(0,r.jsxs)("div",{style:{flex:1,minWidth:0},children:[(0,r.jsx)("div",{style:{fontWeight:700,fontSize:"0.84rem"},children:o.name||c.name}),o.description&&(0,r.jsx)("div",{style:{fontSize:"0.64rem",color:a.muted},children:o.description})]}),(0,r.jsx)(p,{color:c.color+"22",style:{color:c.color},children:o.skill})]}),(0,r.jsxs)("div",{style:{display:"flex",gap:"0.28rem",marginBottom:"0.7rem"},children:[(0,r.jsx)("button",{onClick:()=>d(n),disabled:0===n,style:{background:"none",border:a.border,borderRadius:4,padding:"2px 7px",cursor:"pointer",fontSize:"0.6rem",color:a.muted,opacity:0===n?.3:1},children:"↑ Up"}),(0,r.jsx)("button",{onClick:()=>s(n),disabled:n===t-1,style:{background:"none",border:a.border,borderRadius:4,padding:"2px 7px",cursor:"pointer",fontSize:"0.6rem",color:a.muted,opacity:n===t-1?.3:1},children:"↓ Down"}),(0,r.jsx)("button",{onClick:()=>l(n),style:{background:"none",border:"1px solid ".concat(a.red,"40"),borderRadius:4,padding:"2px 7px",cursor:"pointer",fontSize:"0.6rem",color:a.red},children:"✕ Remove"})]}),0===Object.keys(o.params||{}).length&&(0,r.jsx)("div",{style:{fontSize:"0.7rem",fontFamily:a.mono,color:a.muted,fontStyle:"italic"},children:"No params. Ask in chat to configure."}),Object.entries(o.params||{}).map(e=>{let[o,n]=e;return(0,r.jsx)(x,{label:o,children:"string"==typeof n&&n.length>55?(0,r.jsx)("textarea",{value:n,onChange:e=>i(o,e.target.value),rows:3,style:{width:"100%",boxSizing:"border-box",background:a.bg,border:a.border,borderRadius:a.radius,padding:"0.32rem 0.55rem",fontFamily:a.mono,fontSize:"0.7rem",color:a.text,outline:"none",resize:"vertical"}}):(0,r.jsx)(f,{value:"object"==typeof n?JSON.stringify(n):String(n),onChange:e=>{let n=e;try{n=JSON.parse(e)}catch(e){}i(o,n)}})},o)})]})}function j(e){let{selectedId:o,trigger:n,steps:t,onTriggerChange:i,onStepChange:l,onRemove:d,onMoveUp:s,onMoveDown:c}=e;if(!o)return(0,r.jsx)("div",{style:{padding:"1rem",textAlign:"center",color:a.muted,fontSize:"0.7rem",fontFamily:a.mono,fontStyle:"italic"},children:"Click a node to configure it"});if("__trigger__"===o)return(0,r.jsxs)("div",{style:{padding:"0.85rem 1rem"},children:[(0,r.jsx)(h,{children:"Trigger Config"}),(0,r.jsx)(b,{trigger:n,onChange:i})]});let m=t.findIndex(e=>e.id===o);return m<0?null:(0,r.jsxs)("div",{style:{padding:"0.85rem 1rem"},children:[(0,r.jsxs)(h,{children:["Step ",m+1," Config"]}),(0,r.jsx)(v,{step:t[m],stepIdx:m,stepsLen:t.length,onParamChange:(e,o)=>l(m,{...t[m],params:{...t[m].params,[e]:o}}),onRemove:d,onMoveUp:s,onMoveDown:c})]})}function S(e){let{onAdd:o}=e;return(0,r.jsxs)("div",{style:{padding:"0.65rem 1rem"},children:[(0,r.jsx)(h,{children:"Add Step"}),(0,r.jsx)("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.28rem"},children:s.map(e=>(0,r.jsxs)("button",{onClick:()=>o(e),style:{background:a.faint,border:a.border,borderRadius:a.radius,padding:"0.2rem 0.45rem",cursor:"pointer",fontSize:"0.6rem",fontFamily:a.mono,display:"flex",alignItems:"center",gap:"0.22rem",color:a.muted},onMouseOver:o=>o.currentTarget.style.background=e.color+"18",onMouseOut:e=>e.currentTarget.style.background=a.faint,children:[e.icon," ",e.name]},e.id))})]})}function w(e){let{logs:o}=e;if(!o||0===o.length)return(0,r.jsx)("div",{style:{padding:"2rem",textAlign:"center",color:a.muted,fontSize:"0.78rem",fontFamily:a.mono},children:"No runs yet."});let n=o.reduce((e,o)=>e+(o.powerWh||0),0),t=o.filter(e=>void 0!==e.powerWh).length;return(0,r.jsxs)("div",{style:{padding:"1.5rem"},children:[t>0&&(0,r.jsxs)("div",{style:{background:a.card,border:a.border,borderRadius:a.radius,padding:"0.55rem 1rem",marginBottom:"1rem",display:"flex",gap:"1.2rem",fontSize:"0.67rem",fontFamily:a.mono},children:[(0,r.jsxs)("span",{style:{color:a.orange},children:["⚡ ",(1e3*n).toFixed(4)," mWh total"]}),(0,r.jsxs)("span",{style:{color:a.muted},children:["avg ",(1e3*n/t).toFixed(4)," mWh/run"]})]}),(0,r.jsx)("div",{style:{background:a.card,border:a.border,borderRadius:a.radius,overflow:"hidden"},children:o.map((e,n)=>(0,r.jsxs)("div",{style:{display:"flex",gap:"0.65rem",fontSize:"0.69rem",fontFamily:a.mono,padding:"0.38rem 1rem",borderBottom:n<o.length-1?a.border:"none",alignItems:"center"},children:[(0,r.jsx)("span",{style:{color:a.muted,flexShrink:0,fontSize:"0.6rem"},children:new Date(e.at||Date.now()).toLocaleTimeString()}),(0,r.jsx)("span",{style:{color:!1!==e.success?a.mint:a.red,flexShrink:0},children:!1!==e.success?"✓":"✗"}),(0,r.jsx)("span",{style:{flex:1,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.message||"Completed"}),void 0!==e.powerWh&&(0,r.jsxs)("span",{style:{color:a.orange,flexShrink:0,fontSize:"0.58rem"},children:["⚡",(1e3*e.powerWh).toFixed(4),"mWh ",e.wallSec?"".concat(e.wallSec.toFixed(1),"s"):""]})]},n))})]})}function k(){let e=(0,i.useParams)(),o=(0,i.useSearchParams)(),n=decodeURIComponent(e.id),d=o.get("session"),[s,c]=(0,t.useState)(null),[f,h]=(0,t.useState)(!0),[x,b]=(0,t.useState)(!1),[v,k]=(0,t.useState)(!1),[C,D]=(0,t.useState)(!1),[F,z]=(0,t.useState)([]),[R,T]=(0,t.useState)("flow"),[_,I]=(0,t.useState)(null),[W,E]=(0,t.useState)([]),[B,O]=(0,t.useState)(!1),[H,P]=(0,t.useState)(null),[M,N,A]=(0,l.Rr)([]),[U,L,J]=(0,l.ll)([]),[V,Y]=(0,t.useState)([]),[Z,q]=(0,t.useState)(""),[G,K]=(0,t.useState)(!1),Q=(0,t.useRef)(null);async function X(){try{let e=await fetch("/api/demo/workers/".concat(encodeURIComponent(n),"/logs?sessionId=").concat(d));z((await e.json()).logs||[])}catch(e){}}function $(e,o){E(n=>{let r=[...n],t=e+o;return t<0||t>=r.length||([r[e],r[t]]=[r[t],r[e]]),r}),O(!0)}async function ee(){b(!0);try{let e=await fetch("/api/demo/workers/".concat(encodeURIComponent(n),"/flow"),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionId:d,flow:{trigger:_,steps:W}})}),o=await e.json();o.worker&&(c(o.worker),O(!1))}catch(e){}finally{b(!1)}}async function eo(){k(!0);try{let e=await fetch("/api/demo/workers/deploy",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionId:d,worker:{...s,trigger:_,steps:W}})}),o=await e.json();c(e=>({...e,status:o.status||"deployed"}))}catch(e){}finally{k(!1)}}async function en(){D(!0);try{await fetch("/api/demo/workers/".concat(encodeURIComponent(n),"/run"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionId:d})}),setTimeout(X,2e3)}catch(e){}finally{D(!1)}}async function er(){let e=Z.trim();if(e&&!G){q(""),Y(o=>[...o,{role:"user",content:e}]),K(!0);try{let o=await fetch("/api/demo/workers/".concat(encodeURIComponent(n),"/chat"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionId:d,message:e})}),r=await o.json();Y(e=>[...e,{role:"assistant",content:r.message||"Done."}]),r.worker&&(c(r.worker),I(r.worker.trigger||_),E(r.worker.steps||W),O(!1))}catch(e){Y(o=>[...o,{role:"assistant",content:"Error: "+e.message}])}K(!1)}}if((0,t.useEffect)(()=>{var e;null===(e=Q.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},[V]),(0,t.useEffect)(()=>{if(!_)return;let{nodes:e,edges:o}=function(e,o,n,r){let t=[],i=[];t.push({id:"__trigger__",type:"trigger",position:{x:0,y:0},data:{trigger:e,selected:"__trigger__"===n,onSelect:()=>r("__trigger__")},draggable:!1}),o.forEach((e,l)=>{var d;t.push({id:e.id,type:"step",position:{x:0,y:(l+1)*110},data:{step:e,index:l,selected:n===e.id,onSelect:()=>r(e.id)},draggable:!1});let s=0===l?"__trigger__":o[l-1].id,c=(null===(d=o[l-1])||void 0===d?void 0:d.skill)==="condition";i.push({id:"e".concat(s,"-").concat(e.id),source:s,target:e.id,animated:c,style:{stroke:c?a.purple:"rgba(0,0,0,0.2)",strokeWidth:1.5},type:"smoothstep"})});let l=o.length>0?o[o.length-1].id:"__trigger__";return t.push({id:"__end__",type:"end",position:{x:92,y:(o.length+1)*110},data:{},draggable:!1}),i.push({id:"e".concat(l,"-end"),source:l,target:"__end__",style:{stroke:"rgba(0,0,0,0.18)",strokeWidth:1.5},type:"smoothstep"}),{nodes:t,edges:i}}(_,W,H,e=>P(o=>o===e?null:e));N(e),L(o)},[_,W,H]),(0,t.useEffect)(()=>{s&&(I(s.trigger||{type:"manual",label:"Manual",config:{}}),E(s.steps||[]),O(!1),P(null))},[null==s?void 0:s.id]),(0,t.useEffect)(()=>{if(!n||!d){h(!1);return}fetch("/api/demo/workers/".concat(encodeURIComponent(n),"/flow?sessionId=").concat(d)).then(e=>e.json()).then(e=>{e.worker&&c(e.worker),h(!1)}).catch(()=>h(!1)),X()},[n,d]),f)return(0,r.jsx)("div",{style:{fontFamily:a.mono,background:a.bg,height:"100vh",display:"flex",alignItems:"center",justifyContent:"center",color:a.muted},children:"Loading worker..."});if(!s)return(0,r.jsxs)("div",{style:{fontFamily:a.ui,background:a.bg,height:"100vh",display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",gap:"1rem"},children:[(0,r.jsx)("div",{style:{fontSize:"0.85rem",color:a.muted,fontFamily:a.mono},children:"Worker not found."}),(0,r.jsx)("a",{href:d?"/?session=".concat(d):"/",style:{color:a.blue,fontFamily:a.mono,fontSize:"0.8rem"},children:"← Back to H-Demo"})]});let et={deployed:a.mint,running:a.blue,error:a.red}[null==s?void 0:s.status]||a.faint;return(0,r.jsxs)("div",{style:{fontFamily:a.ui,background:a.bg,color:a.text,height:"100vh",display:"flex",flexDirection:"column",overflow:"hidden"},children:[(0,r.jsxs)("div",{style:{background:a.card,borderBottom:a.border,padding:"0 1.25rem",height:50,display:"flex",alignItems:"center",gap:"0.75rem",flexShrink:0,boxShadow:a.shadow},children:[(0,r.jsx)("a",{href:d?"/?session=".concat(d):"/",style:{fontFamily:a.mono,fontSize:"0.6rem",color:a.muted,textDecoration:"none",textTransform:"uppercase",letterSpacing:"0.06em"},children:"← H-Demo"}),(0,r.jsx)("span",{style:{color:"rgba(0,0,0,0.12)"},children:"|"}),(0,r.jsx)("span",{style:{fontFamily:a.mono,fontWeight:700,fontSize:"0.88rem"},children:null==s?void 0:s.name}),(0,r.jsx)(p,{color:et,children:(null==s?void 0:s.status)||"proposed"}),B&&(0,r.jsx)(p,{color:a.yellow,style:{color:"#000"},children:"Unsaved"}),(0,r.jsx)("div",{style:{flex:1}}),B&&(0,r.jsx)(g,{small:!0,onClick:ee,disabled:x,children:x?"Saving…":"Save"}),(null==s?void 0:s.status)==="deployed"?(0,r.jsx)(g,{small:!0,color:a.blue,onClick:en,disabled:C,children:C?"Running…":"▶ Run"}):(0,r.jsx)(g,{small:!0,color:a.mint,style:{color:a.text},onClick:eo,disabled:v,children:v?"Deploying…":"Deploy"})]}),(0,r.jsx)("div",{style:{background:a.card,borderBottom:a.border,padding:"0 1.25rem",display:"flex"},children:["flow","logs"].map(e=>(0,r.jsx)("button",{onClick:()=>{T(e),"logs"===e&&X()},style:{background:"none",border:"none",padding:"0.5rem 0.85rem",cursor:"pointer",fontSize:"0.6rem",fontFamily:a.mono,textTransform:"uppercase",letterSpacing:"0.06em",color:R===e?a.text:a.muted,borderBottom:R===e?"2px solid ".concat(a.text):"2px solid transparent",marginBottom:-1},children:e},e))}),"flow"===R&&(0,r.jsxs)("div",{style:{flex:1,display:"flex",overflow:"hidden"},children:[(0,r.jsxs)("div",{style:{flex:1,position:"relative"},children:[(0,r.jsxs)(l.x$,{nodes:M,edges:U,onNodesChange:A,onEdgesChange:J,nodeTypes:y,fitView:!0,fitViewOptions:{padding:.3},minZoom:.4,maxZoom:2,proOptions:{hideAttribution:!0},style:{background:a.bg},children:[(0,r.jsx)(l.Aq,{color:"rgba(0,0,0,0.05)",gap:20,size:1}),(0,r.jsx)(l.ZX,{showInteractive:!1,style:{bottom:16,left:16}}),(0,r.jsx)(l.a9,{nodeColor:e=>{var o,n,r,t;return"trigger"===e.type?u(null===(n=e.data)||void 0===n?void 0:null===(o=n.trigger)||void 0===o?void 0:o.type).color:"step"===e.type?m(null===(t=e.data)||void 0===t?void 0:null===(r=t.step)||void 0===r?void 0:r.skill).color:"#ccc"},style:{bottom:16,right:16,borderRadius:8,border:a.border},maskColor:"rgba(244,244,244,0.6)"})]}),(null==s?void 0:s.description)&&(0,r.jsx)("div",{style:{position:"absolute",top:12,left:12,background:a.card,border:a.border,borderRadius:a.radius,padding:"0.35rem 0.65rem",fontSize:"0.68rem",color:a.muted,maxWidth:280,pointerEvents:"none",boxShadow:a.shadow},children:s.description})]}),(0,r.jsxs)("div",{style:{width:320,borderLeft:a.border,display:"flex",flexDirection:"column",overflow:"hidden",flexShrink:0,background:a.card},children:[(0,r.jsx)("div",{style:{overflowY:"auto",borderBottom:a.border,maxHeight:"45%",minHeight:72},children:(0,r.jsx)(j,{selectedId:H,trigger:_,steps:W,onTriggerChange:function(e){I(e),O(!0)},onStepChange:function(e,o){E(n=>n.map((n,r)=>r===e?o:n)),O(!0)},onRemove:function(e){E(o=>o.filter((o,n)=>n!==e)),P(null),O(!0)},onMoveUp:e=>$(e,-1),onMoveDown:e=>$(e,1)})}),(0,r.jsx)("div",{style:{borderBottom:a.border},children:(0,r.jsx)(S,{onAdd:function(e){E(o=>[...o,{id:"s"+Date.now(),skill:e.id,name:e.name,description:e.description||"",params:{}}]),O(!0)}})}),(0,r.jsxs)("div",{style:{flex:1,display:"flex",flexDirection:"column",minHeight:0},children:[(0,r.jsx)("div",{style:{padding:"0.45rem 1rem",borderBottom:a.border,fontSize:"0.55rem",fontFamily:a.mono,color:a.muted,textTransform:"uppercase",letterSpacing:"0.1em"},children:"Worker Chat"}),(0,r.jsxs)("div",{style:{flex:1,overflowY:"auto",padding:"0.55rem 1rem",display:"flex",flexDirection:"column",gap:"0.4rem"},children:[0===V.length&&(0,r.jsx)("div",{style:{color:a.muted,fontSize:"0.67rem",fontStyle:"italic",lineHeight:1.6},children:'e.g. "trigger when orders has new insert", "add a condition if amount > 500", "run hourly"'}),V.map((e,o)=>(0,r.jsx)("div",{style:{display:"flex",justifyContent:"user"===e.role?"flex-end":"flex-start"},children:(0,r.jsx)("div",{style:{maxWidth:"90%",background:"user"===e.role?a.text:a.faint,color:"user"===e.role?"#fff":a.text,borderRadius:a.radius,padding:"0.38rem 0.6rem",fontSize:"0.71rem",lineHeight:1.5},children:e.content})},o)),G&&(0,r.jsx)("div",{style:{color:a.muted,fontSize:"0.67rem",fontStyle:"italic"},children:"Updating flow…"}),(0,r.jsx)("div",{ref:Q})]}),(0,r.jsxs)("div",{style:{borderTop:a.border,padding:"0.45rem 0.6rem",display:"flex",gap:"0.3rem"},children:[(0,r.jsx)("input",{value:Z,onChange:e=>q(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),er())},placeholder:"Modify flow via chat…",disabled:G,style:{flex:1,background:a.bg,border:a.border,borderRadius:a.radius,padding:"0.32rem 0.52rem",fontFamily:a.mono,fontSize:"0.7rem",color:a.text,outline:"none"}}),(0,r.jsx)(g,{small:!0,onClick:er,disabled:G||!Z.trim(),children:"→"})]})]})]})]}),"logs"===R&&(0,r.jsx)("div",{style:{flex:1,overflowY:"auto"},children:(0,r.jsx)(w,{logs:F})})]})}}},function(e){e.O(0,[545,167,895,971,23,744],function(){return e(e.s=6054)}),_N_E=e.O()}]);